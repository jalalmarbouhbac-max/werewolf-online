<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="styles.css">
</head>
<body>

<h1>üê∫ Ultimate Werewolf</h1>

<div id="phase"></div>
<div id="score"></div>

<div id="settings">
<label><input type="checkbox" value="Seer" checked> Seer</label>
<label><input type="checkbox" value="Robber" checked> Robber</label>
<label><input type="checkbox" value="Troublemaker" checked> Troublemaker</label>
<label><input type="checkbox" value="Doppelganger" checked> Doppelganger</label>
<label><input type="checkbox" value="Minion" checked> Minion</label>
<label><input type="checkbox" value="Tanner" checked> Tanner</label>
<label><input type="checkbox" value="Drunk" checked> Drunk</label>
<label><input type="checkbox" value="Hunter" checked> Hunter</label>
<label><input type="checkbox" value="Insomniac" checked> Insomniac</label>
</div>

<div class="card" id="card">
<div class="front">
<img src="images/card-back.png" class="card-back-img">
</div>
<div class="back" id="roleText"></div>
</div>

<button id="startBtn" onclick="startGame()">Start Game</button>

<div id="players"></div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket=io();
const url=new URLSearchParams(location.search);
const room=url.get("room");
const name=url.get("name");

socket.emit("joinRoom",{room,name});

let myRole="";

socket.on("hostAssigned",hostId=>{
if(socket.id!==hostId){
document.getElementById("startBtn").style.display="none";
}
});

socket.on("updatePlayers",data=>{
const players=data.players;
const host=data.host;

const div=document.getElementById("players");
div.innerHTML="";

players.forEach(p=>{
const box=document.createElement("div");
box.className="player-box";

const nameSpan=document.createElement("span");

if(p.id===host){
nameSpan.innerText="üëë "+p.name;
nameSpan.style.color="gold";
}else{
nameSpan.innerText=p.name;
}

box.appendChild(nameSpan);

if(p.id!==socket.id){
const btn=document.createElement("button");
btn.innerText="Vote";
btn.onclick=()=>socket.emit("vote",{room,target:p.id});
box.appendChild(btn);
}

div.appendChild(box);
});
});

socket.on("yourRole",role=>{
document.getElementById("roleText").innerHTML=
"<img src='images/"+role.toLowerCase()+".png' width='120'><br>"+role;
document.getElementById("card").classList.add("flip");
});

socket.on("gameResult",data=>{
alert(data.winner+"\nEliminated: "+data.eliminated+" ("+data.role+")");
});

socket.on("scoreboard",data=>{
document.getElementById("score").innerText=
"üè° "+data.villagers+" | üê∫ "+data.wolves+" | üòà "+data.tanner;
});

function startGame(){
const checkboxes=document.querySelectorAll("#settings input:checked");
const selectedRoles=[];
checkboxes.forEach(cb=>selectedRoles.push(cb.value));
socket.emit("startGameWithRoles",{room,selectedRoles});
}
</script>

</body>
</html>